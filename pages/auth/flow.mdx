---
title: "Authentication Flow"
description: "Complete OAuth 2.0 authorization code flow with PKCE implementation"
---

## Authorization Code Flow

The OAuth 2.0 authorization code flow with PKCE provides secure authentication for accessing Sodex APIs. This flow involves multiple steps to ensure security and prevent unauthorized access.

<Info>
**Prerequisites**: You must have valid `client_id` and `client_secret` credentials from Sodex before starting this flow. If you haven't registered your application yet, please contact [Sodex support](mailto:support@sodex-innovations.com) to obtain your OAuth credentials.
</Info>

<Steps>
  <Step title="Generate PKCE Parameters">
    Create code verifier and challenge for enhanced security
  </Step>
  <Step title="Authorization Request">
    Redirect user to authorization endpoint
  </Step>
  <Step title="User Authorization">
    User grants permission to your application
  </Step>
  <Step title="Authorization Code Receipt">
    Receive authorization code via redirect
  </Step>
  <Step title="Token Exchange">
    Exchange code for access and refresh tokens
  </Step>
  <Step title="API Access">
    Use access token for authenticated requests
  </Step>
</Steps>

## Step 1: Authorization Request

Initiate the OAuth flow by redirecting users to the authorization endpoint.

### Endpoint

```http
GET /oauth/authorize
```

### Required Parameters

<ParamField query="client_id" type="string" required>
  Your application's client ID obtained during registration
</ParamField>

<ParamField query="redirect_uri" type="string" required>
  URL where users will be redirected after authorization
</ParamField>

<ParamField query="response_type" type="string" required>
  Must be `code` for authorization code flow
</ParamField>

<ParamField query="scope" type="string" required>
  Space-separated list of requested scopes (e.g., `sdxapi scanace`)
</ParamField>

<ParamField query="state" type="string" required>
  Random string for CSRF protection - verify this matches on return
</ParamField>

<ParamField query="code_challenge" type="string" required>
  PKCE code challenge (base64url encoded SHA256 hash or plain text)
</ParamField>

<ParamField query="code_challenge_method" type="string" required>
  PKCE challenge method: `S256` (recommended) or `plain`
</ParamField>

### Example Request

```bash
# Construct the authorization URL
https://api.sodex.cloud/oauth/authorize?client_id=your_client_id&redirect_uri=https://your-app.com/callback&response_type=code&scope=sdxapi%20scanace&state=random_state_string&code_challenge=your_code_challenge&code_challenge_method=S256
```

<CodeGroup>
```javascript JavaScript
// Generate PKCE parameters
const generatePKCE = () => {
  const codeVerifier = generateRandomString(128);
  const codeChallenge = base64URLEncode(sha256(codeVerifier));
  return { codeVerifier, codeChallenge };
};

// Construct authorization URL
const { codeVerifier, codeChallenge } = generatePKCE();
const state = generateRandomString(32);

const authUrl = new URL('https://api.sodex.cloud/oauth/authorize');
authUrl.searchParams.set('client_id', 'your_client_id');
authUrl.searchParams.set('redirect_uri', 'https://your-app.com/callback');
authUrl.searchParams.set('response_type', 'code');
authUrl.searchParams.set('scope', 'sdxapi scanace');
authUrl.searchParams.set('state', state);
authUrl.searchParams.set('code_challenge', codeChallenge);
authUrl.searchParams.set('code_challenge_method', 'S256');

// Redirect user to authorization URL
window.location.href = authUrl.toString();
```

```python Python
import secrets
import hashlib
import base64
from urllib.parse import urlencode

# Generate PKCE parameters
code_verifier = base64.urlsafe_b64encode(secrets.token_bytes(32)).decode('utf-8').rstrip('=')
code_challenge = base64.urlsafe_b64encode(
    hashlib.sha256(code_verifier.encode('utf-8')).digest()
).decode('utf-8').rstrip('=')

# Generate state parameter
state = secrets.token_urlsafe(32)

# Construct authorization URL
params = {
    'client_id': 'your_client_id',
    'redirect_uri': 'https://your-app.com/callback',
    'response_type': 'code',
    'scope': 'sdxapi scanace',
    'state': state,
    'code_challenge': code_challenge,
    'code_challenge_method': 'S256'
}

auth_url = f"https://api.sodex.cloud/oauth/authorize?{urlencode(params)}"
print(f"Redirect user to: {auth_url}")
```
</CodeGroup>

## Step 2: Authorization Response

After the user grants permission, they will be redirected to your `redirect_uri` with the authorization code.

### Success Response

```
https://your-app.com/callback?code=AUTHORIZATION_CODE&state=random_state_string
```

### Error Response

```
https://your-app.com/callback?error=access_denied&error_description=User%20denied%20access&state=random_state_string
```

<Warning>
Always verify that the `state` parameter matches the one you sent to prevent CSRF attacks.
</Warning>

## Step 3: Token Exchange

Exchange the authorization code for access and refresh tokens.

### Endpoint

```http
POST /oauth/token
```

### Request Headers

```http
Content-Type: application/x-www-form-urlencoded
```

### Form Parameters

<ParamField body="grant_type" type="string" required>
  Must be `authorization_code`
</ParamField>

<ParamField body="code" type="string" required>
  Authorization code received from the authorization response
</ParamField>

<ParamField body="client_id" type="string" required>
  Your application's client ID
</ParamField>

<ParamField body="client_secret" type="string" required>
  Your application's client secret
</ParamField>

<ParamField body="code_verifier" type="string" required>
  Original PKCE code verifier (before hashing)
</ParamField>

### Example Request

<CodeGroup>
```bash cURL
curl -X POST https://api.sodex.cloud/oauth/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=authorization_code" \
  -d "code=AUTHORIZATION_CODE" \
  -d "client_id=your_client_id" \
  -d "client_secret=your_client_secret" \
  -d "code_verifier=your_code_verifier"
```

```javascript JavaScript
const response = await fetch('https://api.sodex.cloud/oauth/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
  },
  body: new URLSearchParams({
    grant_type: 'authorization_code',
    code: authorizationCode,
    client_id: 'your_client_id',
    client_secret: 'your_client_secret',
    code_verifier: codeVerifier
  })
});

const tokens = await response.json();
```

```python Python
import requests

data = {
    'grant_type': 'authorization_code',
    'code': authorization_code,
    'client_id': 'your_client_id',
    'client_secret': 'your_client_secret',
    'code_verifier': code_verifier
}

response = requests.post(
    'https://api.sodex.cloud/oauth/token',
    headers={'Content-Type': 'application/x-www-form-urlencoded'},
    data=data
)

tokens = response.json()
```
</CodeGroup>

### Success Response

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_in": 28800,
  "token_type": "bearer"
}
```

<ResponseField name="access_token" type="string">
  JWT access token for API authentication
</ResponseField>

<ResponseField name="refresh_token" type="string">
  JWT refresh token for obtaining new access tokens
</ResponseField>

<ResponseField name="expires_in" type="number">
  Access token lifetime in seconds (28800 = 8 hours)
</ResponseField>

<ResponseField name="token_type" type="string">
  Token type, always "bearer"
</ResponseField>

## Step 4: Token Refresh

Refresh expired access tokens using the refresh token.

### Endpoint

```http
POST /oauth/token
```

### Form Parameters

<ParamField body="grant_type" type="string" required>
  Must be `refresh_token`
</ParamField>

<ParamField body="refresh_token" type="string" required>
  Refresh token from the previous token response
</ParamField>

<ParamField body="client_id" type="string" required>
  Your application's client ID
</ParamField>

<ParamField body="client_secret" type="string" required>
  Your application's client secret
</ParamField>

### Example Request

<CodeGroup>
```bash cURL
curl -X POST https://api.sodex.cloud/oauth/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=refresh_token" \
  -d "refresh_token=REFRESH_TOKEN" \
  -d "client_id=your_client_id" \
  -d "client_secret=your_client_secret"
```

```javascript JavaScript
const response = await fetch('https://api.sodex.cloud/oauth/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
  },
  body: new URLSearchParams({
    grant_type: 'refresh_token',
    refresh_token: refreshToken,
    client_id: 'your_client_id',
    client_secret: 'your_client_secret'
  })
});

const newTokens = await response.json();
```

```python Python
import requests

data = {
    'grant_type': 'refresh_token',
    'refresh_token': refresh_token,
    'client_id': 'your_client_id',
    'client_secret': 'your_client_secret'
}

response = requests.post(
    'https://api.sodex.cloud/oauth/token',
    headers={'Content-Type': 'application/x-www-form-urlencoded'},
    data=data
)

new_tokens = response.json()
```
</CodeGroup>

### Response

The response format is identical to the initial token exchange, providing new access and refresh tokens.

## Step 5: Using Access Tokens

Include the access token in the Authorization header for all API requests.

### Authorization Header

```http
Authorization: Bearer YOUR_ACCESS_TOKEN
```

### Example API Request

<CodeGroup>
```bash cURL
curl -X GET https://api.sodex.cloud/v2/users/me \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

```javascript JavaScript
const response = await fetch('https://api.sodex.cloud/v2/users/me', {
  headers: {
    'Authorization': `Bearer ${accessToken}`
  }
});

const userData = await response.json();
```

```python Python
import requests

headers = {
    'Authorization': f'Bearer {access_token}'
}

response = requests.get(
    'https://api.sodex.cloud/v2/users/me',
    headers=headers
)

user_data = response.json()
```
</CodeGroup>

## Best Practices

<CardGroup cols={2}>
  <Card title="Secure Storage" icon="lock">
    Store tokens securely and never expose them in client-side code or URLs
  </Card>
  <Card title="Token Refresh" icon="refresh">
    Implement automatic token refresh before expiration
  </Card>
  <Card title="Error Handling" icon="warning">
    Handle token expiration and authentication errors gracefully
  </Card>
  <Card title="HTTPS Only" icon="shield">
    Always use HTTPS for all OAuth requests in production
  </Card>
</CardGroup>

## Token Lifetimes

| Environment | Access Token | Refresh Token |
|-------------|--------------|---------------|
| Production | 8 hours | 30 days |
| Development | 5 minutes | 10 minutes |

<Info>
Development environments use shorter token lifetimes to facilitate testing of token refresh flows.
</Info>
